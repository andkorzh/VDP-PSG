# Patterns for PSG

This section contains a database of cells for use in the [Patterns](https://github.com/emu-russia/Patterns) utility.

## Гайд по созданию базы данных ячеек PSG

- Картинки для ячеек были взяты прямо с вики и в Paint обрезаны по краям, чтобы задать чёткие границы ячеек
- Лямбда у всех ячеек = 6.0
- В Patterns тоже нужно выставить лямбду 6.0 и горизонтальные ряды (см. PSG_Only.wrk)
- Транзисторы пока не указаны (по нулям). Кому интересна статистика по трансам - нужно будет отдельно указывать в patterns_db.txt для каждой ячейки

## Сложности с комплементарными клонами

Инженеры YAMAHA видимо очень любят когда горит пукан. Поэтому они сделали абсолютно идентичные с виду nand и nor (просто отзеркалив ячейки сверху-вниз).

По итогам стало очень легко запутаться - где nand, а где nor, т.к. никаких визуальных пометок они не оставили:

![image](/imgstore/183283453-cbb36bbc-ed5c-4826-ab9e-c60ed83dd71c.png)

Но если присмотреться и подумать, то можно открыть такое правило:
- В одном ряду ячеек НЕ может быть и NORM и FLIP ячеек. Может быть только NORM / NORM+MIRR или FLIP / FLIP+MIRR.
- Если вы нашли в ряду и FLIP и NORM, то очевидно одна из них не верная

## Как расставляются порты ячеек

Открываем картинку ячейки в Deroute и добавляем порты. Не забыть в настройках Deroute выставить лямбду, соответствующую ячейкам.

![image](/imgstore/183293003-ef1cd747-3c70-43cf-828a-643b57fe994f.png)

Сохраняем сущности и переносим X/Y координаты портов в базу данных:

![image](/imgstore/183293044-101388c8-94b5-4206-8e6b-18eb482da25e.png)

```
pattern aon2222, CellAdder, 6.0, 0, 0, "VDPCells/aon2222.jpg"
vias aon2222, a, 35.25, 22.25, ViasInput, 0
vias aon2222, b, 33.45, 22.18, ViasInput, 0
vias aon2222, c, 31.43, 22.18, ViasInput, 0
vias aon2222, d, 29.49, 22.18, ViasInput, 0
vias aon2222, e, 15.88, 22.39, ViasInput, 0
vias aon2222, f, 14.28, 22.39, ViasInput, 0
vias aon2222, g, 12.33, 22.39, ViasInput, 0
vias aon2222, h, 10.32, 22.38, ViasInput, 0
vias aon2222, x, 1.43, 12.11, ViasOutput, 0
```

Весьма увлекательный процесс, в особенности когда у вас 100+ ячеек..
